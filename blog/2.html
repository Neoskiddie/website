<!DOCTYPE html>
<html lang="en">

<head>
  <title>Grzegorz Bronka - post: Remote-controlled Christmas lights
</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Grzegorz Bronka - personal website." />
<meta name="author" content="Grzegorz Bronka">
<meta name="keywords" content="grzegorz, greg, bronka, programmer, cyber, security, development" />
<link type="text/css" href="../css/googleFonts.css" rel="stylesheet">
<link type="text/css" href="../css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../css/mainPageStyle.css" />
<link type="text/css" href="../css/hamburgers.css" rel="stylesheet">
<!-- favicon stuff -->
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://gregb.pl" />
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<!-- scripts -->
<script defer src="../js/jquery-3.6.0.min.js"></script>
<script defer src="../js/bootstrap.bundle.min.js"></script>
<script defer src="../js/main.js"></script>
<noscript>
   <style>
        .collapse {
            display: block !important;
        }

        #hamburger {
            display: none;
        }


        @media screen and (max-width: 575px) {
            .main-container {
                padding-top: 320px;
            }

            .console-container {
                padding-top: 320px;
            }
        }

        #hidden {
            display: none;
            height: 100px;
            background: red;
        }
        :checked + #hidden {
            display: block;
        }
    </style>

</noscript>


    <!-- specific style only for this page-->
    <link rel="stylesheet" href="../css/github-markdown.min.css">
</head>

<body>
  <nav class="navbar fixed-top navbar-dark navbar-expand-sm" data-toggle="affix">
    <a class="navbar-brand" href="../index.html"><img src="../images/logoWhiteSmall.png" width="51" height="38" alt="GB logo" /></a>
    <button class="hamburger hamburger--spin navbar-toggler" data-toggle="collapse" data-target="#navbarsTarget"
        aria-expanded="false" id="hamburger" aria-label="Toggle navigation" type="button">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>
    <div id="navbarsTarget" class="collapse justify-content-center navbar-collapse text-center">
        <ul class="navbar-nav">
            <li class="nav-item changeLink ">
                <a class="nav-link" href="../index.html">Home</a>
            </li>


            <li class="nav-item changeLink ">
                <a class="nav-link" href="../galery.html">Galery</a>
            </li>
            <li class="nav-item changeLink ">
                <!-- [~]$ whoami -->
                <a class="nav-link" href="../about.html">Whoami</a>
            </li>
            <li class="nav-item changeLink ">
                <a class="nav-link" href="../contact.html">Contact</a>
            </li>
            <li class="nav-item changeLink ">
                <a class="nav-link" href="../blog.html">Blog</a>
            </li>
            <li class="nav-item changeLink ">
                <a class="nav-link" href="../honours.html">Honours</a>
            </li>
        </ul>
    </div>
</nav>
      <div class="container main-container">
        <div class="text-center">
          <h2>
            Remote-controlled Christmas lights
          </h2>
          <p class="text-center">
            Fri Dec 18 2020
          </p>
          <hr />
        </div>
        <article class="markdown-body">
          <p>
            Web interface for controlling Christmas lights from anywhere
          </p>
          <hr />
          <h2>Idea</h2>
<p>The idea was to control the Christmas lights from anywhere. I wanted to be able to turn them on when I’m coming home and don’t waste electricity when I’m away.</p>
<h2>Wiring</h2>
<p>The physical setup used for this project was four relies controlled with <a href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/">Raspberry Pi computer</a>
<img src="../images/BlogPhotos/raspberryPi.jpg" alt="Raspberry Pi"></p>
<p><img src="../images/BlogPhotos/inside.jpg" alt="A view of the inside of the switch"></p>
<p>The wiring allowed to control 250V electrical current with 5V from RasbperryPi.</p>
<h2>Server</h2>
<p>The switches used for the lights couldn’t control the brightness of the lights, so I decided it’ll be best to just turn all of them at once. I used two very simple scripts for that.</p>
<p>All sockets on:</p>
<pre class="hljs"><code>import RPi.GPIO as GPIO # the library to manage Rasbperry Pi pins
import time

# pins setup
GPIO.setmode(GPIO.BCM)
GPIO.setwarnings(False)
pins = [18,17,15,14] 
GPIO.setup(pins, GPIO.OUT)

for pin in pins:
    GPIO.output(pin,  GPIO.LOW)
</code></pre>
<p>All sockets off:</p>
<pre class="hljs"><code># same as previous script
# only the for loop is different:
for pin in pins:
    GPIO.output(pin,  GPIO.HIGH)
GPIO.cleanup();
</code></pre>
<p>Then the scripts were called with GET requests from the website.
Here’s the source code of the simple server handling the requests:</p>
<pre class="hljs"><code>const express = require('express');
const {spawn} = require('child_process');
const app = express();
const path = require('path');
const port = 80;
const fs = require('fs');

var dir = path.join(__dirname, 'public');
app.use(express.static(dir));

app.get('/notARealPath', (req, res) =&gt; {
  res.writeHead(200, { 'content-type': 'text/html' });
  fs.createReadStream('index.html').pipe(res); // serving simple page with a on / off buttons
});

app.get('/allOn', (req, res) =&gt; {
  const scriptPath = 'allOn.py'
  const process = spawn('python', [scriptPath])
    res.sendStatus(200);
  process.stdout.on('data', (myData) =&gt; {
    // ...
    })
    process.stderr.on('data', (myErr) =&gt; {
    // ...
    })
});

app.get('/allOff', (req, res) =&gt; {
  const scriptPath = 'allOff.py'
  const process = spawn('python', [scriptPath])
    res.sendStatus(200);
  process.stdout.on('data', (myData) =&gt; {
    // ...
    })
    process.stderr.on('data', (myErr) =&gt; {
    // ...
    })
});

app.listen(port, () =&gt; console.log(`App listening on port: ${port}`))
</code></pre>
<h2>Outside access</h2>
<p>The main idea for this project was to control the lights from the outside - e.g. to turn them on only when arriving home. The Raspberry Pi used for this project was connected to a local network behind NAT. Without going into too much detail, the usual solution, port forwarding on the router, wasn’t possible in this case and I needed to get outside access to the Pi by other means.</p>
<p>The solution was to set up an outside server that relied all the HTTP requests to the Raspberry Pi. To do that I used a reverse SSH connection that basically forwarded the local website to the remote server port 8080:</p>
<pre class="hljs"><code>autossh -NR 8080:localhost:80 -i &lt;remote server SSH key&gt; user@&lt;remote server IP&gt;
</code></pre>
<h2>Final note</h2>
<p>It would be better to use POST requests, but GET requests worked fine for this simple project.</p>
<p>The page had no security other than long paths for the requests, but even if someone guessed the paths used in the actual server, this is basically over-engineered light switch <a href="https://www.youtube.com/watch?v=onZ4KMM94yI">https://www.youtube.com/watch?v=onZ4KMM94yI</a></p>
<p><img src="../images/BlogPhotos/lights.jpg" alt="Lights"></p>

        </article>
      </div>
    <footer class="text-center">
    <div class="container">
        <a href="https://github.com/Neoskiddie"><img width="20" src="../images/github.png" alt="github icon"></a>
        <a href="https://www.linkedin.com/in/grzegorz-bronka"><img width="20" src="../images/linkedin.png" alt="github icon"></a>
        <div class="row">
            <div class="col-12">
                <p>Copyright &#169; 2023 Grzegorz Bronka. All rights reserved.</p>
            </div>
        </div>
    </div>
</footer>

</body>

</html>
